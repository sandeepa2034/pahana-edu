<!DOCTYPE html>
<html
  lang="en"
  xmlns:th="http://www.thymeleaf.org"
  xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Book Management - Pahana Edu Bookshop</title>

    <!-- Modern Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />

    <!-- CSS Dependencies -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <link href="/css/modern-design-system.css" rel="stylesheet" />
    <link href="/css/admin-dashboard.css" rel="stylesheet" />
  </head>
  <body>
    <!-- Modern Navigation -->
    <nav class="navbar-modern fixed-top">
      <div class="container">
        <div class="d-flex justify-content-between align-items-center w-100">
          <a class="navbar-brand-modern" href="/admin/dashboard">
            <i class="fas fa-user-shield"></i>
            <span>Admin Portal</span>
          </a>

          <div class="d-none d-lg-flex align-items-center gap-4">
            <nav class="d-flex gap-2">
              <a class="nav-link-modern" href="/admin/dashboard">
                <i class="fas fa-tachometer-alt"></i>Dashboard
              </a>
              <a class="nav-link-modern" href="/admin/customers">
                <i class="fas fa-users"></i>Customers
              </a>
              <a class="nav-link-modern" href="/admin/orders">
                <i class="fas fa-shopping-bag"></i>Orders
              </a>
              <a class="nav-link-modern active" href="/admin/items">
                <i class="fas fa-book"></i>Books
              </a>
            </nav>
          </div>

          <div class="d-flex align-items-center gap-3">
            <a
              href="/"
              class="btn btn-outline-primary btn-sm"
              title="Visit Site"
            >
              <i class="fas fa-external-link-alt me-1"></i>Visit Site
            </a>

            <div class="dropdown">
              <button
                class="btn btn-primary dropdown-toggle"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                <i class="fas fa-user-shield me-1"></i>
                <span sec:authentication="name">Admin</span>
              </button>
              <ul
                class="dropdown-menu dropdown-menu-end shadow-lg border-0 modern-dropdown"
              >
                <li>
                  <a class="dropdown-item py-2" href="/profile">
                    <i class="fas fa-user-cog me-2 text-primary"></i>Profile
                  </a>
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li>
                  <a class="dropdown-item py-2 text-danger" href="/logout">
                    <i class="fas fa-sign-out-alt me-2"></i>Logout
                  </a>
                </li>
              </ul>
            </div>
          </div>

          <button
            class="btn btn-outline-primary d-lg-none"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarNav"
            aria-controls="navbarNav"
            aria-expanded="false"
          >
            <i class="fas fa-bars"></i>
          </button>
        </div>

        <div class="collapse navbar-collapse" id="navbarNav">
          <div class="d-flex flex-column gap-2 mt-3 d-lg-none">
            <a class="nav-link-modern" href="/admin/dashboard">
              <i class="fas fa-tachometer-alt"></i>Dashboard
            </a>
            <a class="nav-link-modern" href="/admin/customers">
              <i class="fas fa-users"></i>Customers
            </a>
            <a class="nav-link-modern" href="/admin/orders">
              <i class="fas fa-shopping-bag"></i>Orders
            </a>
            <a class="nav-link-modern active" href="/admin/items">
              <i class="fas fa-book"></i>Books
            </a>
          </div>
        </div>
      </div>
    </nav>

    <!-- Page Header -->
    <section class="hero-section-admin py-5">
      <div class="container">
        <div class="row align-items-center">
          <div class="col-lg-8">
            <div class="hero-content">
              <div
                class="badge-modern mb-3"
                style="
                  background: var(--accent-amber-light);
                  color: var(--accent-amber);
                "
              >
                <i class="fas fa-book me-2"></i>Inventory Management
              </div>
              <h1
                class="display-4 fw-bold mb-3"
                style="color: var(--text-primary)"
              >
                Book Catalog
              </h1>
              <p class="lead mb-4" style="color: var(--text-secondary)">
                Manage your bookshop inventory, add new titles, update pricing,
                and track stock levels across all categories.
              </p>
              <div class="d-flex gap-3">
                <button
                  class="btn-modern btn-primary"
                  data-bs-toggle="modal"
                  data-bs-target="#addBookModal"
                >
                  <i class="fas fa-plus me-2"></i>Add New Book
                </button>
                <a href="/shop" class="btn-modern btn-secondary">
                  <i class="fas fa-store me-2"></i>View Shop
                </a>
              </div>
            </div>
          </div>
          <div class="col-lg-4 text-end">
            <div class="hero-stats card-modern p-4">
              <div class="d-flex align-items-center gap-3 mb-3">
                <div
                  class="stats-icon-small"
                  style="
                    background: var(--accent-amber-light);
                    color: var(--accent-amber);
                  "
                >
                  <i class="fas fa-book"></i>
                </div>
                <div>
                  <h6 class="mb-0 text-secondary">Total Books</h6>
                  <span class="fw-bold fs-4" th:text="${books?.size() ?: 0}"
                    >0</span
                  >
                </div>
              </div>
              <div class="d-flex align-items-center gap-3">
                <div
                  class="stats-icon-small"
                  style="
                    background: var(--accent-emerald-light);
                    color: var(--accent-emerald);
                  "
                >
                  <i class="fas fa-check-circle"></i>
                </div>
                <div>
                  <h6 class="mb-0 text-secondary">In Stock</h6>
                  <span class="badge-success">Available</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- Main Content -->
    <section class="py-5">
      <div class="container">
        <!-- Search and Filter Section -->
        <div class="card-modern mb-4">
          <div class="card-body">
            <div class="row g-3 align-items-center">
              <div class="col-md-4">
                <div class="input-group">
                  <span class="input-group-text">
                    <i class="fas fa-search"></i>
                  </span>
                  <input
                    type="text"
                    class="form-control"
                    id="searchBooks"
                    placeholder="Search books by title, author, or ISBN..."
                  />
                </div>
              </div>
              <div class="col-md-2">
                <select class="form-select" id="filterCategory">
                  <option value="">All Categories</option>
                  <option value="fiction">Fiction</option>
                  <option value="non-fiction">Non-Fiction</option>
                  <option value="textbook">Textbooks</option>
                  <option value="reference">Reference</option>
                </select>
              </div>
              <div class="col-md-2">
                <select class="form-select" id="filterStock">
                  <option value="">All Stock</option>
                  <option value="in-stock">In Stock</option>
                  <option value="low-stock">Low Stock</option>
                  <option value="out-of-stock">Out of Stock</option>
                </select>
              </div>
              <div class="col-md-4">
                <div class="d-flex gap-2">
                  <button
                    class="btn btn-outline-primary"
                    onclick="exportBooks()"
                  >
                    <i class="fas fa-download me-1"></i>Export
                  </button>
                  <button
                    class="btn btn-outline-secondary"
                    onclick="importBooks()"
                  >
                    <i class="fas fa-upload me-1"></i>Import
                  </button>
                  <button
                    class="btn btn-outline-secondary"
                    onclick="refreshBooks()"
                  >
                    <i class="fas fa-sync-alt me-1"></i>Refresh
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Books Grid/List View -->
        <div class="card-modern">
          <div class="card-header">
            <div class="d-flex align-items-center justify-content-between">
              <h5 class="mb-0">
                <i class="fas fa-book me-2 text-primary"></i>Book Inventory
              </h5>
              <div class="d-flex align-items-center gap-3">
                <span
                  class="badge"
                  style="
                    background: var(--primary-100);
                    color: var(--primary-700);
                  "
                >
                  <span th:text="${books?.size() ?: 0}">0</span> books
                </span>
                <div class="btn-group btn-group-sm">
                  <button
                    class="btn btn-outline-primary active"
                    id="gridViewBtn"
                    onclick="switchView('grid')"
                  >
                    <i class="fas fa-th"></i>
                  </button>
                  <button
                    class="btn btn-outline-primary"
                    id="listViewBtn"
                    onclick="switchView('list')"
                  >
                    <i class="fas fa-list"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
          <div class="card-body">
            <!-- Grid View -->
            <div id="gridView" class="row g-4">
              <div th:if="${books == null or books.empty}" class="col-12">
                <div class="text-center py-5 text-muted">
                  <i class="fas fa-book fa-3x mb-3 opacity-25"></i>
                  <div>
                    <h6>No books found</h6>
                    <p class="mb-0">
                      Start building your inventory by adding your first book
                    </p>
                  </div>
                </div>
              </div>
              <div
                th:each="book,bookStat : ${books}"
                class="col-lg-3 col-md-4 col-sm-6 book-item"
              >
                <div class="book-card h-100">
                  <div class="book-image">
                    <!-- CSS-based book cover with dynamic colors -->
                    <div
                      class="book-cover-placeholder"
                      th:class="'book-cover-placeholder book-cover-' + (${bookStat.index % 4} + 1)"
                    >
                      <div class="book-cover-content">
                        <i class="fas fa-book-open text-white fs-1 mb-3"></i>
                        <div
                          class="book-cover-title text-white fw-bold text-center"
                          th:text="${book.title}"
                        >
                          Book Title
                        </div>
                      </div>
                    </div>
                    <div class="book-overlay">
                      <button
                        class="btn btn-light btn-sm"
                        data-book-id=""
                        th:data-book-id="${book.id}"
                        onclick="viewBook(this.dataset.bookId)"
                        title="View Details"
                      >
                        <i class="fas fa-eye"></i>
                      </button>
                      <button
                        class="btn btn-light btn-sm"
                        data-book-id=""
                        th:data-book-id="${book.id}"
                        onclick="editBook(this.dataset.bookId)"
                        title="Edit Book"
                      >
                        <i class="fas fa-edit"></i>
                      </button>
                      <button
                        class="btn btn-danger btn-sm"
                        data-book-id=""
                        th:data-book-id="${book.id}"
                        onclick="deleteBook(this.dataset.bookId)"
                        title="Delete Book"
                      >
                        <i class="fas fa-trash"></i>
                      </button>
                    </div>
                  </div>
                  <div class="book-content p-3">
                    <h6 class="book-title mb-2" th:text="${book.title}">
                      Book Title
                    </h6>
                    <p
                      class="book-author text-muted mb-2"
                      th:text="${book.author}"
                    >
                      Author Name
                    </p>
                    <div
                      class="d-flex justify-content-between align-items-center mb-2"
                    >
                      <span
                        class="book-price fw-bold"
                        th:text="'$' + ${book.price}"
                        >$0.00</span
                      >
                      <span
                        class="badge"
                        th:classappend="${book.stock > 10 ? 'badge-success' : (book.stock > 0 ? 'badge-warning' : 'badge-error')}"
                        th:text="${book.stock} + ' in stock'"
                        >0 in stock</span
                      >
                    </div>
                    <div class="book-actions d-grid gap-2">
                      <div class="btn-group d-flex" role="group">
                        <button
                          class="btn btn-outline-primary btn-sm"
                          data-book-id=""
                          th:data-book-id="${book.id}"
                          onclick="editBook(this.dataset.bookId)"
                          title="Edit Book"
                        >
                          <i class="fas fa-edit me-1"></i>Edit
                        </button>
                        <button
                          class="btn btn-outline-danger btn-sm"
                          data-book-id=""
                          th:data-book-id="${book.id}"
                          onclick="deleteBook(this.dataset.bookId)"
                          title="Delete Book"
                        >
                          <i class="fas fa-trash me-1"></i>Delete
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- List View -->
            <div id="listView" class="d-none">
              <div class="table-responsive">
                <table class="table table-hover">
                  <thead class="table-light">
                    <tr>
                      <th>Book</th>
                      <th>Author</th>
                      <th>Category</th>
                      <th>Price</th>
                      <th>Stock</th>
                      <th>Status</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr th:if="${books == null or books.empty}">
                      <td colspan="7" class="text-center py-5 text-muted">
                        <i class="fas fa-book fa-3x mb-3 opacity-25"></i>
                        <div>
                          <h6>No books found</h6>
                          <p class="mb-0">
                            Start building your inventory by adding your first
                            book
                          </p>
                        </div>
                      </td>
                    </tr>
                    <tr th:each="book,bookStat : ${books}" class="book-row">
                      <td>
                        <div class="d-flex align-items-center">
                          <div
                            class="book-thumbnail me-3"
                            th:class="'book-thumbnail me-3 book-cover-' + (${bookStat.index % 4} + 1)"
                            style="width: 60px; height: 80px; display: flex; align-items: center; justify-content: center; border-radius: 8px;"
                          >
                            <i class="fas fa-book text-white"></i>
                          </div>
                          <div>
                            <div class="fw-semibold" th:text="${book.title}">
                              Book Title
                            </div>
                            <small class="text-muted" th:text="${book.isbn}"
                              >ISBN</small
                            >
                          </div>
                        </div>
                      </td>
                      <td th:text="${book.author}">Author Name</td>
                      <td>
                        <span
                          class="badge"
                          style="
                            background: var(--primary-100);
                            color: var(--primary-700);
                          "
                          th:text="${book.category}"
                          >Category</span
                        >
                      </td>
                      <td class="fw-semibold" th:text="'$' + ${book.price}">
                        $0.00
                      </td>
                      <td>
                        <span th:text="${book.stock}">0</span>
                        <small class="text-muted">units</small>
                      </td>
                      <td>
                        <span
                          class="badge"
                          th:classappend="${book.stock > 10 ? 'badge-success' : (book.stock > 0 ? 'badge-warning' : 'badge-error')}"
                          th:text="${book.stock > 0} ? 'In Stock' : 'Out of Stock'"
                          >In Stock</span
                        >
                      </td>
                      <td>
                        <div class="btn-group btn-group-sm">
                          <button
                            class="btn btn-outline-primary"
                            data-book-id=""
                            th:data-book-id="${book.id}"
                            onclick="viewBook(this.dataset.bookId)"
                            title="View Details"
                          >
                            <i class="fas fa-eye"></i>
                          </button>
                          <button
                            class="btn btn-outline-secondary"
                            data-book-id=""
                            th:data-book-id="${book.id}"
                            onclick="editBook(this.dataset.bookId)"
                            title="Edit Book"
                          >
                            <i class="fas fa-edit"></i>
                          </button>
                          <button
                            class="btn btn-outline-danger"
                            data-book-id=""
                            th:data-book-id="${book.id}"
                            onclick="deleteBook(this.dataset.bookId)"
                            title="Delete Book"
                          >
                            <i class="fas fa-trash"></i>
                          </button>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Modern Footer -->
    <footer
      class="py-4"
      style="
        background: var(--bg-secondary);
        border-top: 1px solid var(--neutral-200);
      "
    >
      <div class="container">
        <div class="row align-items-center">
          <div class="col-md-6">
            <p class="mb-0 text-secondary">
              <i class="fas fa-book me-2 text-primary"></i>
              Book Management - Pahana Edu Bookshop
            </p>
          </div>
          <div class="col-md-6 text-end">
            <p class="mb-0 text-tertiary">
              &copy; 2025 Pahana Edu. Administrative access only.
            </p>
          </div>
        </div>
      </div>
    </footer>

    <!-- Add Book Modal -->
    <div
      class="modal fade"
      id="addBookModal"
      tabindex="-1"
      aria-labelledby="addBookModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="addBookModalLabel">
              <i class="fas fa-plus-circle me-2 text-primary"></i>Add New Book
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <form id="addBookForm" method="post" action="/admin/items/create" enctype="multipart/form-data">
            <div class="modal-body">
              <div class="row g-3">
                <div class="col-md-8">
                  <div class="row g-3">
                    <div class="col-md-6">
                      <label for="title" class="form-label">Title *</label>
                      <input
                        type="text"
                        class="form-control"
                        id="title"
                        name="title"
                        required
                      />
                    </div>
                    <div class="col-md-6">
                      <label for="author" class="form-label">Author *</label>
                      <input
                        type="text"
                        class="form-control"
                        id="author"
                        name="author"
                        required
                      />
                    </div>
                    <div class="col-md-6">
                      <label for="isbn" class="form-label">ISBN *</label>
                      <input
                        type="text"
                        class="form-control"
                        id="isbn"
                        name="isbn"
                        required
                      />
                    </div>
                    <div class="col-md-6">
                      <label for="category" class="form-label">Category *</label>
                      <select class="form-select" id="category" name="category" required>
                        <option value="">Select Category</option>
                        <option value="fiction">Fiction</option>
                        <option value="non-fiction">Non-Fiction</option>
                        <option value="textbook">Textbooks</option>
                        <option value="reference">Reference</option>
                      </select>
                    </div>
                    <div class="col-md-6">
                      <label for="price" class="form-label">Price *</label>
                      <div class="input-group">
                        <span class="input-group-text">$</span>
                        <input
                          type="number"
                          class="form-control"
                          id="price"
                          name="price"
                          step="0.01"
                          min="0"
                          required
                        />
                      </div>
                    </div>
                    <div class="col-md-6">
                      <label for="stock" class="form-label">Stock Quantity *</label>
                      <input
                        type="number"
                        class="form-control"
                        id="stock"
                        name="stock"
                        min="0"
                        required
                      />
                    </div>
                    <div class="col-md-6">
                      <label for="publisher" class="form-label">Publisher</label>
                      <input
                        type="text"
                        class="form-control"
                        id="publisher"
                        name="publisher"
                      />
                    </div>
                    <div class="col-md-6">
                      <label for="publishYear" class="form-label">Publish Year</label>
                      <input
                        type="number"
                        class="form-control"
                        id="publishYear"
                        name="publishYear"
                        min="1900"
                        max="2025"
                      />
                    </div>
                    <div class="col-12">
                      <label for="description" class="form-label">Description *</label>
                      <textarea
                        class="form-control"
                        id="description"
                        name="description"
                        rows="3"
                        required
                      ></textarea>
                    </div>
                  </div>
                </div>
                <div class="col-md-4">
                  <label class="form-label">Book Cover Preview</label>
                  <div class="text-center">
                    <div class="book-cover-placeholder book-cover-1" 
                         style="width: 180px; height: 240px; margin: 0 auto; border-radius: 12px;">
                      <div class="book-cover-content">
                        <i class="fas fa-book-open text-white fs-1 mb-3"></i>
                        <div class="book-cover-title text-white fw-bold text-center" 
                             id="titlePreview">Book Title</div>
                      </div>
                    </div>
                    <small class="text-muted mt-2 d-block">
                      <i class="fas fa-info-circle me-1"></i>
                      Cover will be generated automatically based on title
                    </small>
                  </div>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-outline-secondary"
                data-bs-dismiss="modal"
              >
                Cancel
              </button>
              <button type="submit" class="btn btn-primary">
                <i class="fas fa-save me-1"></i>Save Book
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Edit Book Modal -->
    <div
      class="modal fade"
      id="editBookModal"
      tabindex="-1"
      aria-labelledby="editBookModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="editBookModalLabel">
              <i class="fas fa-edit me-2 text-primary"></i>Edit Book
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <form id="editBookForm" method="post" enctype="multipart/form-data">
            <input type="hidden" id="editBookId" name="id" />
            <div class="modal-body">
              <div class="row g-3">
                <div class="col-md-8">
                  <div class="row g-3">
                    <div class="col-md-6">
                      <label for="editTitle" class="form-label">Title *</label>
                      <input
                        type="text"
                        class="form-control"
                        id="editTitle"
                        name="title"
                        required
                      />
                    </div>
                    <div class="col-md-6">
                      <label for="editAuthor" class="form-label">Author *</label>
                      <input
                        type="text"
                        class="form-control"
                        id="editAuthor"
                        name="author"
                        required
                      />
                    </div>
                    <div class="col-md-6">
                      <label for="editIsbn" class="form-label">ISBN *</label>
                      <input
                        type="text"
                        class="form-control"
                        id="editIsbn"
                        name="isbn"
                        required
                      />
                    </div>
                    <div class="col-md-6">
                      <label for="editCategory" class="form-label">Category *</label>
                      <select class="form-select" id="editCategory" name="category" required>
                        <option value="">Select Category</option>
                        <option value="fiction">Fiction</option>
                        <option value="non-fiction">Non-Fiction</option>
                        <option value="textbook">Textbooks</option>
                        <option value="reference">Reference</option>
                      </select>
                    </div>
                    <div class="col-md-6">
                      <label for="editPrice" class="form-label">Price *</label>
                      <div class="input-group">
                        <span class="input-group-text">$</span>
                        <input
                          type="number"
                          class="form-control"
                          id="editPrice"
                          name="price"
                          step="0.01"
                          min="0"
                          required
                        />
                      </div>
                    </div>
                    <div class="col-md-6">
                      <label for="editStock" class="form-label">Stock Quantity *</label>
                      <input
                        type="number"
                        class="form-control"
                        id="editStock"
                        name="stock"
                        min="0"
                        required
                      />
                    </div>
                    <div class="col-md-6">
                      <label for="editPublisher" class="form-label">Publisher</label>
                      <input
                        type="text"
                        class="form-control"
                        id="editPublisher"
                        name="publisher"
                      />
                    </div>
                    <div class="col-md-6">
                      <label for="editPublishYear" class="form-label">Publish Year</label>
                      <input
                        type="number"
                        class="form-control"
                        id="editPublishYear"
                        name="publishYear"
                        min="1900"
                        max="2025"
                      />
                    </div>
                    <div class="col-12">
                      <label for="editDescription" class="form-label">Description *</label>
                      <textarea
                        class="form-control"
                        id="editDescription"
                        name="description"
                        rows="3"
                        required
                      ></textarea>
                    </div>
                  </div>
                </div>
                <div class="col-md-4">
                  <label class="form-label">Book Cover Preview</label>
                  <div class="text-center">
                    <div class="book-cover-placeholder book-cover-2" 
                         style="width: 180px; height: 240px; margin: 0 auto; border-radius: 12px;"
                         id="editBookCoverPreview">
                      <div class="book-cover-content">
                        <i class="fas fa-book-open text-white fs-1 mb-3"></i>
                        <div class="book-cover-title text-white fw-bold text-center" 
                             id="editTitlePreview">Book Title</div>
                      </div>
                    </div>
                    <small class="text-muted mt-2 d-block">
                      <i class="fas fa-info-circle me-1"></i>
                      Cover design based on book title
                    </small>
                  </div>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-outline-secondary"
                data-bs-dismiss="modal"
              >
                Cancel
              </button>
              <button type="submit" class="btn btn-primary">
                <i class="fas fa-save me-1"></i>Update Book
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      // Custom styles for book cards and upload area
      document.addEventListener("DOMContentLoaded", function () {
        const style = document.createElement("style");
        style.textContent = `
                .book-card {
                    background: var(--bg-primary);
                    border: 1px solid var(--neutral-200);
                    border-radius: var(--radius-xl);
                    transition: all var(--transition-normal);
                    overflow: hidden;
                }
                
                .book-card:hover {
                    transform: translateY(-4px);
                    box-shadow: var(--shadow-lg);
                    border-color: var(--neutral-300);
                }
                
                .book-image {
                    position: relative;
                    height: 200px;
                    overflow: hidden;
                    background: var(--bg-secondary);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                }
                
                .book-image img {
                    width: 100%;
                    height: 100%;
                    object-fit: cover;
                }
                
                .book-overlay {
                    position: absolute;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0, 0, 0, 0.7);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    gap: 0.5rem;
                    opacity: 0;
                    transition: opacity 0.3s ease;
                }
                
                .book-card:hover .book-overlay {
                    opacity: 1;
                }
                
                .book-title {
                    font-weight: var(--font-semibold);
                    color: var(--text-primary);
                    display: -webkit-box;
                    -webkit-line-clamp: 2;
                    -webkit-box-orient: vertical;
                    overflow: hidden;
                }
                
                .book-author {
                    font-size: var(--text-sm);
                    display: -webkit-box;
                    -webkit-line-clamp: 1;
                    -webkit-box-orient: vertical;
                    overflow: hidden;
                }
                
                .book-price {
                    color: var(--primary-600);
                    font-size: var(--text-lg);
                }
            `;
        document.head.appendChild(style);
      });

      // View switching
      function switchView(viewType) {
        const gridView = document.getElementById("gridView");
        const listView = document.getElementById("listView");
        const gridBtn = document.getElementById("gridViewBtn");
        const listBtn = document.getElementById("listViewBtn");

        if (viewType === "grid") {
          gridView.classList.remove("d-none");
          listView.classList.add("d-none");
          gridBtn.classList.add("active");
          listBtn.classList.remove("active");
        } else {
          gridView.classList.add("d-none");
          listView.classList.remove("d-none");
          listBtn.classList.add("active");
          gridBtn.classList.remove("active");
        }
      }

      // Search functionality
      document
        .getElementById("searchBooks")
        .addEventListener("input", function (e) {
          const searchTerm = e.target.value.toLowerCase();
          const bookItems = document.querySelectorAll(".book-item, .book-row");

          bookItems.forEach((item) => {
            const text = item.textContent.toLowerCase();
            item.style.display = text.includes(searchTerm) ? "" : "none";
          });
        });

      // Title preview functionality for add form
      document
        .getElementById("title")
        .addEventListener("input", function (e) {
          const title = e.target.value || "Book Title";
          document.getElementById("titlePreview").textContent = title;
        });

      // Title preview functionality for edit form  
      document
        .getElementById("editTitle")
        .addEventListener("input", function (e) {
          const title = e.target.value || "Book Title";
          document.getElementById("editTitlePreview").textContent = title;
        });

      // Book management functions
      function viewBook(bookId) {
        // Redirect to view page or show modal with book details
        window.open(`/admin/items/${bookId}/view`, '_blank');
      }

      function editBook(bookId) {
        // Fetch book data and populate edit modal
        fetch(`/admin/items/${bookId}/edit`)
          .then(response => response.json())
          .then(book => {
            // Populate edit form
            document.getElementById('editBookId').value = book.id;
            document.getElementById('editTitle').value = book.title;
            document.getElementById('editAuthor').value = book.author;
            document.getElementById('editIsbn').value = book.isbn;
            document.getElementById('editCategory').value = book.category;
            document.getElementById('editPrice').value = book.price;
            document.getElementById('editStock').value = book.stock;
            document.getElementById('editPublisher').value = book.publisher || '';
            document.getElementById('editPublishYear').value = book.publishYear || '';
            document.getElementById('editDescription').value = book.description;
            
            // Update title preview
            document.getElementById('editTitlePreview').textContent = book.title || 'Book Title';
            
            // Set form action
            document.getElementById('editBookForm').action = `/admin/items/${bookId}/update`;
            
            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('editBookModal'));
            modal.show();
          })
          .catch(error => {
            console.error('Error fetching book data:', error);
            alert('Error loading book data. Please try again.');
          });
      }

      function deleteBook(bookId) {
        if (confirm("Are you sure you want to delete this book? This action cannot be undone.")) {
          fetch(`/admin/items/${bookId}/delete`, {
            method: 'DELETE',
            headers: {
              'Content-Type': 'application/json',
              'X-Requested-With': 'XMLHttpRequest'
            }
          })
          .then(response => {
            if (response.ok) {
              // Remove book card from UI
              const bookCard = document.querySelector(`[data-book-id="${bookId}"]`).closest('.col-lg-3, tr');
              if (bookCard) {
                bookCard.remove();
              }
              alert('Book deleted successfully!');
            } else {
              throw new Error('Failed to delete book');
            }
          })
          .catch(error => {
            console.error('Error deleting book:', error);
            alert('Error deleting book. Please try again.');
          });
        }
      }

      // Handle form submissions
      document.getElementById('addBookForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const formData = new FormData(this);
        
        fetch('/admin/items/create', {
          method: 'POST',
          body: formData
        })
        .then(response => {
          if (response.ok) {
            alert('Book added successfully!');
            const modal = bootstrap.Modal.getInstance(document.getElementById('addBookModal'));
            modal.hide();
            this.reset();
            document.getElementById('coverPreview').style.display = 'none';
            // Reload page to show new book
            window.location.reload();
          } else {
            throw new Error('Failed to add book');
          }
        })
        .catch(error => {
          console.error('Error adding book:', error);
          alert('Error adding book. Please try again.');
        });
      });

      document.getElementById('editBookForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const formData = new FormData(this);
        const bookId = document.getElementById('editBookId').value;
        
        fetch(`/admin/items/${bookId}/update`, {
          method: 'POST',
          body: formData
        })
        .then(response => {
          if (response.ok) {
            alert('Book updated successfully!');
            const modal = bootstrap.Modal.getInstance(document.getElementById('editBookModal'));
            modal.hide();
            // Reload page to show updated book
            window.location.reload();
          } else {
            throw new Error('Failed to update book');
          }
        })
        .catch(error => {
          console.error('Error updating book:', error);
          alert('Error updating book. Please try again.');
        });
      });

      // Handle edit book cover upload
      document.getElementById('editBookCover').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function(e) {
            document.getElementById('editPreviewImage').src = e.target.result;
            document.getElementById('editCoverPreview').style.display = 'block';
            document.getElementById('editUploadPlaceholder').style.display = 'none';
          };
          reader.readAsDataURL(file);
        }
      });

      function exportBooks() {
        console.log("Export books");
      }

      function importBooks() {
        console.log("Import books");
      }

      function refreshBooks() {
        window.location.reload();
      }
    </script>
  </body>
</html>
